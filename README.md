#Resonance

A modern, minimalist, single-page picture gallery web application with synchronized audio for each group of pictures. Designed for a seamless, immersive viewing experience with robust preloading and cross-browser compatibility.

## Table of Contents

1. [Project Overview](#1-project-overview)
2. [Main Features](#2-main-features)
3. [Security Features](#3-security-features)
4. [Cross-Browser Compatibility](#4-cross-browser-compatibility)
5. [Responsive Design](#5-responsive-design)
6. [Installation & Setup](#6-installation--setup)
7. [Configuration](#7-configuration)
8. [Development Workflow](#8-development-workflow)
9. [Future Features Backlog](#9-future-features-backlog)
10. [Limitations](#10-limitations)
11. [Credits](#11-credits)
12. [License](#12-license)

---

## 1. Project Overview

**Resonance** is an audio-synchronized picture gallery designed to present collections of images where each collection (group) is accompanied by a specific looping soundtrack. It prioritizes a fast, smooth, and preloaded browsing experience, making it ideal for:

-   **Art Galleries & Exhibitions**: Digital displays of artwork with ambient sound.
-   **Portfolios**: Photographers or designers showcasing themed work.
-   **Storytelling**: Visual narratives enhanced by audio atmosphere.
-   **Personal Projects**: Curated collections of memories.

---

## 2. Main Features

### Core Functionality
-   **Grouped Image Gallery**: Images are organized into groups.
-   **Looping Audio**: Each group has a dedicated audio track that loops seamlessly.
-   **Auto-Generated Configuration**: The gallery configuration is automatically generated by scanning the `assets/groups/` folder structure, eliminating manual config maintenance.
-   **Smart Preloading**:
    -   **Critical Path**: Only audio + first image of current group loaded before UI appears (< 2 seconds)
    -   **High Priority**: Remaining images in current group + adjacent groups loaded in background
    -   **Lazy Loading**: Groups within proximity (distance ≤ 2) preloaded with lower priority
    -   Exit with Escape key or fullscreen button.
-   **Touch & Gesture Navigation**:
    -   **Swipe Left/Right**: Navigate between images.
    -   **Tap**: Toggle UI visibility (immersive mode).
    -   **Long Press**: Pause/Resume audio.
-   **Keyboard Shortcuts**:
    -   **Arrow Keys**: Navigate left/right.
    -   **Space**: Play/Pause audio.
    -   **F**: Toggle fullscreen.
    -   **M**: Mute/Unmute.
    -   **Escape**: Exit fullscreen.
### Architecture

The project follows a clean, modular vanilla JavaScript architecture:

-   **`index.html`**: The main entry point and DOM structure.
-   **`styles.css`**: All styling, including responsive layouts and animations.
-   **`js/main.js`**: Application entry point, wiring up components and DOM events.
-   **`js/gallery.js`**: Manages gallery state, navigation logic, and slide transitions.
-   **`js/audioPlayer.js`**: Handles audio playback, volume, looping, and track switching.
-   **`js/assetLoader.js`**: Manages preloading and caching of images and audio.
-   **`js/touchControls.js`**: Handles touch gestures (swipe, tap, long-press).
-   **`js/fullscreen.js`**: Manages fullscreen mode and auto-hiding controls.
-   **`js/browserCompatibility.js`**: Detects browser features and sets the runtime mode.
-   **`js/generatedConfig.js`**: Auto-generated file containing the gallery structure (DO NOT EDIT).
-   **`scripts/generateGalleryConfig.mjs`**: Node.js script to generate the config from folder structure.
-   **`scripts/reorganize-pictures.js`**: Utility script to reorganize pictures into sound-specific folders based on structure.html mappings.

---

## 3. Security Features

While client-side protection is never absolute, this project implements "best-effort" hardening:

-   **Content Security Policy (CSP)**: Strict CSP in `<meta>` tag restricts sources to `'self'` and specific safe origins, preventing XSS attacks.
-   **No Inline Execution**: Relies on external scripts; `eval()` and `new Function()` are avoided (except for controlled compatibility checks).
-   **Content Protection**:
    -   Right-click context menu disabled on images.
    -   Drag-and-drop disabled on images.
    -   CSS `user-select: none` to prevent highlighting.
    -   iOS long-press menu disabled.
-   **Sanitization**: Uses `textContent` instead of `innerHTML` when updating dynamic text to prevent injection.

> **Note**: Complete protection against downloading images requires server-side authentication and tokenized URLs.

---

## 4. Cross-Browser Compatibility

    -   **Mobile**: Vertical stack, maximized image area, touch-friendly buttons.
    -   **Tablet**: Adjusted spacing and sizing.
    -   **Desktop**: Centered layout with max-width constraints for optimal viewing.
-   **Touch Interactions**: Full swipe and tap support makes the mobile experience feel native.

---

## 6. Installation & Setup

### Prerequisites
-   **Node.js** (for config generation)
-   A simple **static web server** (e.g., VS Code Live Server, Python `http.server`, or `serve`). *Direct file access (`file://`) may block audio autoplay due to browser security policies.*

### Step-by-Step

1.  **Clone/Download** the repository.
2.  **Organize Assets**:
    Place your content in the `assets/groups/` directory:
    ```
    assets/
    └── groups/
        ├── group1/
        │   ├── image1.jpg
        │   ├── image2.jpg
        │   └── ambient.ogg
        └── group2/
            ├── photo_a.jpg
            └── sound.mp3
    ```
3.  **Generate Configuration**:
    Run the generation script to create `js/generatedConfig.js`:
    ```bash
    node scripts/generateGalleryConfig.mjs
    ```

---

## 7. Configuration

You can customize the gallery behavior by creating a `settings.json` file in the root directory. You can copy `settings.example.json` to start.

### Available Options

| Section | Option | Type | Default | Description |
| :--- | :--- | :--- | :--- | :--- |
| **Top Level** | `enableSound` | `boolean` | `true` | Master switch to enable or disable all audio features. |
| **ui** | `pageTitle` | `string` | `"Resonance"` | The title that appears in the browser tab. |
| | `buttonLabels` | `object` | `{ previous: "Previous", next: "Next" }` | Custom text for navigation buttons. |
| | `messages` | `object` | `{ startPrompt: "...", loading: "..." }` | Custom text for the loading overlay. |
| **timing** | `transitionDuration` | `number` (ms) | `200` | Duration of the slide transition animation. |
| | `fullscreenControlsHideDelay` | `number` (ms) | `3000` | Time before controls auto-hide in fullscreen mode. |
| | `longPressDuration` | `number` (ms) | `800` | Time required to trigger a long-press action. |
| **touch** | `swipeThreshold` | `number` (px) | `50` | Minimum swipe distance to trigger navigation. |
| | `tapThreshold` | `number` (px) | `10` | Maximum movement allowed for a tap to register. |
| **performance** | `maxCacheSize` | `number` | `50` | Maximum number of assets to keep in memory. |
| | `concurrencyLimit` | `number` | `6` | Maximum number of simultaneous downloads. |
| **transitions** | `type` | `string` | `"fade"` | Transition effect: `"fade"`, `"crossfade"`, or `"none"`. |
| | `duration` | `number` (ms) | `200` | Specific duration for the transition effect (overrides timing.transitionDuration). |

---

## 10. Troubleshooting

### Audio Doesn't Play
- **Cause**: Browsers block auto-playing audio to prevent annoyance.
- **Fix**: The gallery requires a user interaction (click/tap) to start. Ensure you click the "Click to Enter" overlay.

### Images/Audio Not Loading (Local Files)
- **Cause**: Opening `index.html` directly (file:// protocol) often blocks loading external assets due to CORS security.
- **Fix**: You must use a local web server (e.g., `npx serve`, Python `http.server`, or VS Code Live Server).

### Fullscreen Not Working
- **Cause**: Some mobile browsers (especially on iOS) restrict fullscreen API or require it to be triggered by a direct user gesture.
- **Fix**: Ensure you are tapping the fullscreen button directly. Note that iOS Safari has limited fullscreen API support compared to Android.

### "Browser Outdated" Warning
- **Cause**: You are using a browser that lacks ES6 features (Promises, Fetch).
- **Fix**: Update to the latest version of Chrome, Firefox, Edge, or Safari.

---

## 11. Credits

-   **Developer**: Antigravity (Google DeepMind)
-   **Concept**: Modern Audio Gallery

---

## 12. License

This project is licensed under the MIT License.